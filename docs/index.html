<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TFBD Map â€” Tribal Fusion Belly Dance Events</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">

  <!-- Site CSS (keep this relative for GitHub Pages and Vercel) -->
  <link rel="stylesheet" href="./assets/styles.css" />

  <style>
    /* Keep the exact theme you built */
    :root {
      --bg: #0f0f14;
      --panel: rgba(255,255,255,0.06);
      --text: #f6f6f7;
      --muted: #b9bcc6;
      --accent: #e9a6c1; /* soft feminine pink */
      --accent-2: #b2d9d0; /* mint */
      --radius: 16px;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: "Poppins", system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      color: var(--text);
      background: linear-gradient(180deg, #0b0b10 0%, #1a1824 100%);
      min-height: 100dvh;
    }
    .hero {
      position: relative;
      padding: 48px 16px 24px;
      text-align: center;
      overflow: hidden;
      isolation: isolate;
    }
    .hero::before {
      content: "";
      position: absolute;
      inset: 0;
      background: url("./public/images/dancer-background.png") center/cover no-repeat;
      opacity: 0.18;
      z-index: -1;
      filter: contrast(110%) saturate(110%);
    }
    .title {
      font-family: "Dancing Script", cursive;
      font-size: clamp(36px, 6vw, 64px);
      font-weight: 700;
      letter-spacing: 0.5px;
      color: var(--text);
      text-shadow: 0 2px 18px rgba(233,166,193,0.25);
    }
    .subtitle {
      margin: 8px auto 0;
      color: var(--muted);
      max-width: 720px;
      line-height: 1.5;
    }
    .pill {
      display: inline-block;
      margin-top: 14px;
      padding: 6px 12px;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(233,166,193,0.22), rgba(178,217,208,0.18));
      font-size: 12px;
      color: var(--text);
    }
    .container {
      width: min(1100px, 92vw);
      margin: 16px auto 56px;
    }
    .panel {
      background: var(--panel);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: var(--radius);
      backdrop-filter: blur(6px);
      box-shadow: 0 10px 30px rgba(0,0,0,0.25);
      overflow: hidden;
      margin-bottom: 28px;
    }
    .panel-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 16px 16px;
      border-bottom: 1px solid rgba(255,255,255,0.08);
      background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
    }
    .panel-header h2 {
      margin: 0;
      font-size: 18px;
      font-weight: 600;
    }
    .meta {
      font-size: 12px;
      color: var(--muted);
    }
    .table-wrap {
      overflow: auto;
      max-height: 70vh; /* scrollable table */
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
      min-width: 760px;
    }
    thead th {
      position: sticky;
      top: 0;
      z-index: 2;
      background: #1f1d2a;
      color: var(--text);
      text-align: left;
      padding: 12px;
      border-bottom: 1px solid rgba(255,255,255,0.08);
      font-weight: 600;
    }
    thead tr.filters th {
      top: 44px; /* second sticky row */
      background: #1b1925;
      border-bottom: 1px solid rgba(255,255,255,0.06);
    }
    thead input {
      width: 100%;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.06);
      color: var(--text);
      outline: none;
    }
    tbody td {
      padding: 12px;
      border-bottom: 1px solid rgba(255,255,255,0.06);
      vertical-align: top;
    }
    tbody tr:hover { background: rgba(255,255,255,0.04); }
    a.link {
      color: var(--accent-2);
      text-decoration: none;
      word-break: break-all;
    }
    a.link:hover { text-decoration: underline; }
    .badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(233,166,193,0.18);
      color: #ffddea;
      font-size: 12px;
      margin-left: 8px;
    }
    .footer {
      text-align: center;
      color: var(--muted);
      font-size: 12px;
      padding: 18px 0 40px;
    }
    .hidden { display: none; }
  </style>
</head>
<body>
  <header class="hero">
    <div class="pill">For TFBD/ FCBD/ Fusion Dancers</div>
    <h1 class="title"><strong>TFBD Map</strong></h1>
    <p class="subtitle">A living list of Tribal Fusion Belly Dance events worldwide. Filter by name, date, location, or jump to the original link.</p>
  </header>

  <main class="container">
    <!-- Upcoming -->
    <section class="panel" aria-labelledby="upcoming-heading">
      <div class="panel-header">
        <h2 id="upcoming-heading">Upcoming Events <span class="badge" id="upcoming-count">0</span></h2>
        <div class="meta" id="last-updated" aria-live="polite">Loading latest data</div>
      </div>
      <div class="table-wrap">
        <table id="upcoming-table">
          <thead>
            <tr>
              <th style="width: 32%">Event name</th>
              <th style="width: 12%">Start date</th>
              <th style="width: 12%">End date</th>
              <th style="width: 24%">Location</th>
              <th style="width: 20%">URL</th>
            </tr>
            <tr class="filters">
              <th><input id="u-filter-name" type="text" placeholder="Filter by name"></th>
              <th><input id="u-filter-start" type="text" placeholder="dd/mm/yyyy"></th>
              <th><input id="u-filter-end" type="text" placeholder="dd/mm/yyyy"></th>
              <th><input id="u-filter-location" type="text" placeholder="State, Country"></th>
              <th><input id="u-filter-url" type="text" placeholder="Filter by domain"></th>
            </tr>
          </thead>
          <tbody id="upcoming-body"></tbody>
        </table>
      </div>
    </section>

    <!-- Past -->
    <section class="panel" aria-labelledby="past-heading">
      <div class="panel-header">
        <h2 id="past-heading">Past Events <span class="badge" id="past-count">0</span></h2>
        <div class="meta" id="past-meta">Archive of previous events</div>
      </div>
      <div class="table-wrap">
        <table id="past-table">
          <thead>
            <tr>
              <th style="width: 32%">Event name</th>
              <th style="width: 12%">Start date</th>
              <th style="width: 12%">End date</th>
              <th style="width: 24%">Location</th>
              <th style="width: 20%">URL</th>
            </tr>
            <tr class="filters">
              <th><input id="p-filter-name" type="text" placeholder="Filter by name"></th>
              <th><input id="p-filter-start" type="text" placeholder="dd/mm/yyyy"></th>
              <th><input id="p-filter-end" type="text" placeholder="dd/mm/yyyy"></th>
              <th><input id="p-filter-location" type="text" placeholder="State, Country"></th>
              <th><input id="p-filter-url" type="text" placeholder="Filter by domain"></th>
            </tr>
          </thead>
          <tbody id="past-body"></tbody>
        </table>
      </div>
    </section>

    <p class="footer">Tip: Dates use dd/mm/yyyy. Update sources in <code>websites_list.txt</code> and the scraper will refresh the data daily.</p>
  </main>

  <!-- Site JS (keep this relative) -->
  <script src="./assets/script.js" defer></script>

  <script>
    /* ===========
       DATA CONFIG
       =========== */
    // Default: load from your repo (works on both GitHub Pages and Vercel if file exists at /data/events.json)
    const USE_CDN = false; // set to true to use raw.githack CDN
    const LOCAL_JSON_URL = "./data/events.json";
    const CDN_JSON_URL = "https://raw.githack.com/YOUR_GITHUB_USERNAME/YOUR_REPO_NAME/main/data/events.json"; // <-- replace if USE_CDN = true

    const EVENTS_JSON_URL = USE_CDN ? CDN_JSON_URL : LOCAL_JSON_URL;

    /* ===========
       DOM HOOKS
       =========== */
    const els = {
      // meta
      lastUpdated: document.getElementById("last-updated"),
      // upcoming table
      uBody: document.getElementById("upcoming-body"),
      uCount: document.getElementById("upcoming-count"),
      uName: document.getElementById("u-filter-name"),
      uStart: document.getElementById("u-filter-start"),
      uEnd: document.getElementById("u-filter-end"),
      uLoc: document.getElementById("u-filter-location"),
      uUrl: document.getElementById("u-filter-url"),
      // past table
      pBody: document.getElementById("past-body"),
      pCount: document.getElementById("past-count"),
      pName: document.getElementById("p-filter-name"),
      pStart: document.getElementById("p-filter-start"),
      pEnd: document.getElementById("p-filter-end"),
      pLoc: document.getElementById("p-filter-location"),
      pUrl: document.getElementById("p-filter-url"),
    };

    /* ===========
       HELPERS
       =========== */
    const safe = (val) => (val ?? "").toString().trim();

    function toRowHTML(evt) {
      const name = safe(evt.name || evt.event_name || evt.title);
      const start = safe(evt.start_date || evt.start);
      const end = safe(evt.end_date || evt.end);
      const loc = safe(evt.location || evt.city || evt.place);
      const url = safe(evt.url || evt.link || evt.source);
      const linkHTML = url ? `<a class="link" href="${url}" target="_blank" rel="noopener">Open</a>` : "";
      return `
        <td>${name}</td>
        <td>${start}</td>
        <td>${end}</td>
        <td>${loc}</td>
        <td>${linkHTML}</td>
      `;
    }

    function renderTable(items, tbodyEl, countEl) {
      tbodyEl.innerHTML = items.map(r => `<tr>${toRowHTML(r)}</tr>`).join("");
      countEl.textContent = items.length;
    }

    function makeFilterFn(inputs) {
      // inputs: { name, start, end, loc, url }
      return (evt) => {
        const name = safe(evt.name || evt.event_name || evt.title).toLowerCase();
        const start = safe(evt.start_date || evt.start).toLowerCase();
        const end = safe(evt.end_date || evt.end).toLowerCase();
        const loc = safe(evt.location || evt.city || evt.place).toLowerCase();
        const url = safe(evt.url || evt.link || evt.source).toLowerCase();

        return (
          name.includes(inputs.name.value.toLowerCase()) &&
          start.includes(inputs.start.value.toLowerCase()) &&
          end.includes(inputs.end.value.toLowerCase()) &&
          loc.includes(inputs.loc.value.toLowerCase()) &&
          url.includes(inputs.url.value.toLowerCase())
        );
      };
    }

    function wireFilters(sourceArray, inputs, tbodyEl, countEl) {
      const apply = () => {
        const pass = makeFilterFn(inputs);
        const filtered = sourceArray.filter(pass);
        renderTable(filtered, tbodyEl, countEl);
      };
      Object.values(inputs).forEach(inp => inp.addEventListener("input", apply));
      // Initial filter (no input)
      apply();
    }

    /* ===========
       LOAD + INIT
       =========== */
    let UPCOMING = [];
    let PAST = [];

    async function loadData() {
      try {
        const res = await fetch(EVENTS_JSON_URL, { cache: "no-store" });
        if (!res.ok) throw new Error(`Failed to fetch events.json: ${res.status}`);
        const data = await res.json();

        // Accept either:
        // 1) { upcoming: [], past: [], last_updated: "..." }
        // 2) [ ... ]  (flat array treated as upcoming)
        if (Array.isArray(data)) {
          UPCOMING = data;
          PAST = [];
        } else {
          UPCOMING = Array.isArray(data.upcoming) ? data.upcoming : (Array.isArray(data.events_upcoming) ? data.events_upcoming : []);
          PAST = Array.isArray(data.past) ? data.past : (Array.isArray(data.events_past) ? data.events_past : []);
          els.lastUpdated.textContent = `Last updated: ${safe(data.last_updated) || new Date().toLocaleString()}`;
        }

        // Render initial tables
        renderTable(UPCOMING, els.uBody, els.uCount);
        renderTable(PAST, els.pBody, els.pCount);

        // Wire filters
        wireFilters(
          UPCOMING,
          { name: els.uName, start: els.uStart, end: els.uEnd, loc: els.uLoc, url: els.uUrl },
          els.uBody,
          els.uCount
        );
        wireFilters(
          PAST,
          { name: els.pName, start: els.pStart, end: els.pEnd, loc: els.pLoc, url: els.pUrl },
          els.pBody,
          els.pCount
        );
      } catch (err) {
        console.warn(err);
        els.lastUpdated.textContent = "Could not load data";
        // Clear tables on error
        renderTable([], els.uBody, els.uCount);
        renderTable([], els.pBody, els.pCount);
      }
    }

    loadData();
  </script>
</body>
</html>
